#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR=$( cd -- "$( dirname -- $(readlink -f "$0") )" &> /dev/null && pwd )
WORK_DIR=$(pwd)

LOCAL_ENV=
# Load .env from current working directory if present
if [[ -f "${WORK_DIR}/.env" ]]; then
  LOCAL_ENV="${WORK_DIR}/.env"
fi

usage() {
  cat <<EOF
Usage: start [codex CLI args...]

Starts the Codex CLI Docker container and passes any additional arguments to the codex command inside the container.
EOF
}

if [[ "${1:-}" =~ ^(-h|--help)$ ]]; then
  usage
  exit 0
fi

echo "ðŸš€ Starting Codex CLI..."
if command -v docker-compose > /dev/null 2>&1; then
  DC="docker-compose"
else
  DC="docker compose"
fi
WORK_DIR=${WORK_DIR} LOCAL_ENV=${LOCAL_ENV} ${DC} -f "${SCRIPT_DIR}/docker-compose.yml" run --rm codex "$@"
